drop database if exist bd_caf_1;
create database bd_caf_1;

create table utilisateur (

    id serial,
    login varchar(20),
    profile varchar(14),
    empreinte varchar(32),
    email varchar(56),

  primary key (login)
);

create table obligatoire(
    id_user int,
    id_form int,

    primary key(id_user),
    primary key(id_form),
    foreign key(id_user) references utilisateur(id),
    foreign key(id_form) references cours(id)

)


create table cours(

    id serial,
    chemin varchar(250),
    titre varchar(30),

    primary key (id)
);

create table quizz(

	id serial,
    titre varchar(30),
    id_cours int,

    primary key (id)
);

alter table quizz ADD CONSTRAINT fk_id_cours foreign key(id_cours) references cours(id);

create table question (

    id serial,
	quest varchar(250),
	correct varchar(250),
	reponse_1 varchar(250),
	reponse_2 varchar(250),
	reponse_3 varchar(250),
    id_quizz int,

    primary key(id_quizz),
	foreign key(id_quizz) references quizz(id)
);

create table score (

    id serial,
    id_user int,
    id_quizz int,
    valeur int,
    realiser date,

    primary key(id),
    foreign key(id_user) references utilisateur(id),
    foreign key(id_quizz) references quizz(id)

);

drop user if exists uti_quizz;
create user uti_caf login password 'admin';
grant all on quizz, utilisateur, question, score, obligatoire to uti_caf;
grant all on utilisateur_id_seq, quizz_id_seq, question_id_seq, score_id_seq to uti_caf; -- Ã  cause de serial